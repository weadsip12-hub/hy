<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>hy blog</title>
  <style>
    :root { --w: 920px; }
    body { margin: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial; background:#0b0f14; color:#e6edf3; }
    a { color:#79c0ff; text-decoration:none; }
    a:hover { text-decoration:underline; }
    header { padding: 32px 16px 12px; border-bottom:1px solid #1f2937; background:#0b0f14; position:sticky; top:0; }
    .wrap { max-width: var(--w); margin: 0 auto; }
    .title { display:flex; gap:12px; align-items:baseline; justify-content:space-between; }
    h1 { margin:0; font-size: 22px; letter-spacing:0.2px; }
    .sub { margin: 8px 0 0; color:#9aa4b2; font-size: 13px; }
    main { padding: 18px 16px 40px; }
    .controls { display:flex; gap:10px; margin: 14px 0 18px; }
    input { flex:1; padding: 10px 12px; border-radius:12px; border:1px solid #243041; background:#0f1722; color:#e6edf3; }
    .card { border:1px solid #1f2937; background:#0f1722; border-radius:16px; padding: 14px 14px; margin: 10px 0; }
    .meta { color:#9aa4b2; font-size: 12px; margin-top: 6px; display:flex; gap:10px; flex-wrap:wrap; }
    .badge { border:1px solid #2b3a51; color:#c9d1d9; padding:2px 8px; border-radius:999px; font-size: 11px; }
    .empty { color:#9aa4b2; padding: 18px 0; }
    footer { border-top:1px solid #1f2937; padding: 16px; color:#9aa4b2; font-size: 12px; }
    pre { white-space:pre-wrap; }
  </style>

  <!-- Markdown 렌더러 (GitHub Pages에서 그냥 동작) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <h1><a href="./">hy blog</a></h1>
        <a href="https://github.com/weadsip12-hub/hy" target="_blank" rel="noreferrer">GitHub</a>
      </div>
      <p class="sub">posts 폴더의 글을 목록으로 보여주고, 클릭하면 본문을 읽는 단순 블로그</p>

      <div class="controls">
        <input id="q" placeholder="검색 (제목/태그)" />
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="view"></div>
  </main>

  <footer>
    <div class="wrap">© hy • GitHub Pages</div>
  </footer>

<script>
  const view = document.getElementById('view');
  const q = document.getElementById('q');

  function esc(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function renderList(posts, keyword=''){
    const k = keyword.trim().toLowerCase();
    const filtered = posts.filter(p => {
      if(!k) return true;
      const hay = (p.title + ' ' + (p.tags||[]).join(' ')).toLowerCase();
      return hay.includes(k);
    });

    if(filtered.length === 0){
      view.innerHTML = `<div class="empty">검색 결과가 없어.</div>`;
      return;
    }

    view.innerHTML = filtered.map(p => `
      <div class="card">
        <div><a href="#/post/${encodeURIComponent(p.file)}"><strong>${esc(p.title)}</strong></a></div>
        <div class="meta">
          <span>${esc(p.date || '')}</span>
          ${(p.tags||[]).map(t => `<span class="badge">${esc(t)}</span>`).join('')}
        </div>
        ${p.desc ? `<div class="meta">${esc(p.desc)}</div>` : ``}
      </div>
    `).join('');
  }

  async function loadPosts(){
    const res = await fetch('./blog/posts.json', { cache: 'no-store' });
    if(!res.ok) throw new Error('posts.json을 못 불러왔어. 파일 경로/이름 확인!');
    const posts = await res.json();
    // 최신 날짜가 위로 오도록 정렬
    posts.sort((a,b) => String(b.date).localeCompare(String(a.date)));
    return posts;
  }

  async function renderPost(file){
    const res = await fetch('./blog/posts/' + file, { cache: 'no-store' });
    if(!res.ok){
      view.innerHTML = `<div class="empty">포스트 파일을 못 불러왔어: ${esc(file)}</div>`;
      return;
    }
    const md = await res.text();
    const html = marked.parse(md);
    view.innerHTML = `
      <div class="card">
        <div style="margin-bottom:10px;"><a href="#/">← 목록으로</a></div>
        <div>${html}</div>
      </div>
    `;
    window.scrollTo(0,0);
  }

  function getRoute(){
    const h = location.hash || '#/';
    const m = h.match(/^#\/post\/(.+)$/);
    return m ? { type:'post', file: decodeURIComponent(m[1]) } : { type:'list' };
  }

  let POSTS = [];

  async function router(){
    const route = getRoute();
    if(route.type === 'post'){
      await renderPost(route.file);
    } else {
      renderList(POSTS, q.value);
    }
  }

  (async () => {
    try{
      POSTS = await loadPosts();
      q.addEventListener('input', () => renderList(POSTS, q.value));
      window.addEventListener('hashchange', router);
      await router();
    } catch(e){
      view.innerHTML = `<div class="empty">${esc(e.message)}</div>`;
    }
  })();
</script>
</body>
</html>

